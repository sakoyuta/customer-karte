<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é¡§å®¢ã‚«ãƒ«ãƒ†çµ±åˆã‚·ã‚¹ãƒ†ãƒ </title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
  <style>
    @media print {
      .no-print { display: none !important; }
      body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

      /* ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Šåˆ¶å¾¡ */
      .pk  { page-break-inside: avoid !important; break-inside: avoid !important; }
      .pb  { page-break-before: always !important; break-before: page !important; }
      .pao { page-break-after:  avoid  !important; break-after:  avoid  !important; }

      /* ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã¯é€”ä¸­ã§åˆ‡ã‚‰ãªã„ */
      tr   { page-break-inside: avoid !important; break-inside: avoid !important; }
      /* ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å„ãƒšãƒ¼ã‚¸ã§ç¹°ã‚Šè¿”ã™ */
      thead { display: table-header-group; }

      /* å°åˆ·æ™‚ï¼šå¤–æ ã® border ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å€‹åˆ¥ã§ä»˜ä¸
         â†’ ãƒšãƒ¼ã‚¸ã‚’ã¾ãŸã„ã§å´é¢ç·šãŒè²«é€šã™ã‚‹ã®ã‚’é˜²ã */
      .karte-outer {
        border: none !important;
      }
      /* å„ç›´æ¥å­è¦ç´ ã«å·¦å³ç·šã‚’ä»˜ä¸ï¼ˆéš£æ¥ã™ã‚‹ã®ã§ç¶™ãç›®ãªãä¸€æœ¬ç·šã«è¦‹ãˆã‚‹ï¼‰ */
      .karte-outer > * {
        border-left:  1px solid black !important;
        border-right: 1px solid black !important;
      }
      /* å…ˆé ­è¦ç´ ï¼ˆã‚«ãƒ«ãƒ†ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ã¨å¼·åˆ¶æ”¹ãƒšãƒ¼ã‚¸è¦ç´ ï¼ˆBãƒ»Cè¦‹å‡ºã—ï¼‰ã«ä¸Šç·šã‚’ä»˜ä¸ */
      .karte-outer > *:first-child,
      .karte-outer > .pb {
        border-top: 1px solid black !important;
      }

      /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã—ãŒãƒšãƒ¼ã‚¸æœ«å°¾ã«å­¤ç«‹ã—ãªã„ã‚ˆã†ã« */
      .sec-hd { page-break-after: avoid !important; break-after: avoid !important; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ======== Supabase åˆæœŸåŒ– ========
    const SUPABASE_URL = 'https://nknrarqdmkddiybnqfjj.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_Xr6ShDGUY04XTDs5tT5_lg_Y0ulKidY';
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ======== ã‚¢ã‚¤ã‚³ãƒ³ ========
    const IcMap    = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>;
    const IcTrain  = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 2C6.5 2 4 5 4 9v8l2 2h12l2-2V9c0-4-2.5-7-8-7zm0 0v4M4 14h16M8 18v2M16 18v2"/></svg>;
    const IcHome   = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>;
    const IcHeart  = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>;
    const IcPrint  = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>;
    const IcUser   = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>;
    const IcCoins  = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>;
    const IcClock  = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>;
    const IcFlask  = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3h6m-6 0a1 1 0 00-1 1v6.586a1 1 0 01-.293.707l-5 5C1.854 17.146 3 19 4.707 19h14.586C21 19 22.146 17.146 21.293 16.293l-5-5A1 1 0 0116 10.586V4a1 1 0 00-1-1M9 3h6"/></svg>;
    const IcGrid   = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>;
    const IcClip   = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>;
    const IcPlay   = () => <svg className="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>;
    const IcFile   = () => <svg className="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>;
    const IcCalc   = () => <svg className="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>;
    const IcPlus   = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>;
    const IcSave   = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>;
    const IcBack   = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>;
    const IcTrash  = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>;
    const IcEdit   = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>;
    const IcCheck    = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>;
    const IcSettings = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>;

    // ======== åˆæœŸãƒ‡ãƒ¼ã‚¿ ========
    const emptyKarteData = () => ({
      sheetHeader: { belong: '', staffName: '', customerName: '', targetDate: '', rank: '' },
      basic: {
        rep: { name: '', age: '', contact: '', address: '', income: '', years: '' },
        partner: { name: '', age: '', income: '', years: '' },
        familyMembers: [
          { role: 'çˆ¶', age: '', job: '', income: '', coLiveNow: '', coLiveFuture: '' },
          { role: 'æ¯', age: '', job: '', income: '', coLiveNow: '', coLiveFuture: '' },
          { role: 'ç¾©çˆ¶', age: '', job: '', income: '', coLiveNow: '', coLiveFuture: '' },
          { role: 'ç¾©æ¯', age: '', job: '', income: '', coLiveNow: '', coLiveFuture: '' },
        ]
      },
      general: {
        life: { station: '', stationTime: '', housingType: '', family: '', homeLoc: '', hobby: '', reason: '', trigger: '', interest: '', currentMaker: '', rent: '', parking: '', otherCost: '' },
        land: { hasLand: '', areaReason: '', commuteGoal: '', parentsRel: '', stationThought: '', currentHomeReason: '', landBudget: '' },
        building: { floors: '', rooms: '', extraRooms: '', layoutPoint: '', goals: '', cars: '', garden: '', buildingBudget: '' },
        money: { husbandIncome: '', wifeIncome: '', downPayment: '', savings: '', existingLoan: '', idealPayment: '', rentGap: '', totalBudget: '', monthlyHope: '', aid: '' },
        time: { period: '', limit: '', reason: '' },
        rival: { name: '', pros: '', cons: '' },
        testClose: { hasTest: '', result: '', complaints: '', nextDetail: '' }
      },
      landDetail: {
        area: { target: '', whyDeep: '' },
        husband: { dest: '', time: '', method: '', feeling: '', limit: '' },
        wife: { dest: '', time: '', method: '', feeling: '', limit: '' },
        station: { importance: '', logic: '', current: '' },
        parents: { loc: '', importance: '', access: '' },
        priorities: [
          { id: 'p1', label: 'é§…ã¾ã§ã®è·é›¢', note: '' },
          { id: 'p2', label: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ã€è–¬å±€', note: '' },
          { id: 'p3', label: 'å°å­¦æ ¡ã¾ã§ã®è·é›¢', note: '' },
          { id: 'p4', label: 'ç—…é™¢ãŒã‚ã‚‹ã‹', note: '' },
          { id: 'p5', label: 'åˆ†è­²åœ°', note: '' },
          { id: 'p6', label: 'å‰é“ã®åºƒã•', note: '' },
          { id: 'p7', label: 'ãã®åœŸåœ°ã¾ã§ã®é“ã®ç‹­ã•', note: '' },
        ],
        ng: [
          { id: 'n1', label: 'ãƒã‚¶ãƒ¼ãƒ‰', note: '' },
          { id: 'n2', label: 'è¿‘ãã«å·ã€æ±  â€»è™«ãƒ»è‡­ã„ãªã©', note: '' },
          { id: 'n3', label: 'è¡—é ­å°‘ãªãæš—ã„ â€»å¨˜ã•ã‚“ã„ã‚‹å ´åˆãªã©', note: '' },
          { id: 'n4', label: 'äº¤é€šé‡ã®å¤šã•', note: '' },
        ]
      }
    });

    // ======== å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ========
    const Section = ({ title, icon: Icon, children }) => (
      <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
        <div className="bg-slate-50 px-6 py-3 border-b border-slate-200 flex items-center gap-2">
          <span className="text-blue-600"><Icon /></span>
          <h2 className="text-lg font-bold text-slate-800">{title}</h2>
        </div>
        <div className="p-6">{children}</div>
      </div>
    );

    const InputField = ({ label, placeholder = "", value, onChange, type = "text" }) => (
      <div className="mb-4">
        <label className="block text-sm font-bold text-slate-700 mb-1">{label}</label>
        <input type={type} className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm" placeholder={placeholder} value={value} onChange={(e) => onChange(e.target.value)} />
      </div>
    );

    const TextAreaField = ({ label, placeholder = "", value, onChange }) => (
      <div className="mb-4">
        <label className="block text-sm font-bold text-slate-700 mb-1">{label}</label>
        <textarea className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm min-h-[60px]" placeholder={placeholder} value={value} onChange={(e) => onChange(e.target.value)} />
      </div>
    );

    const UnitInput = ({ label, value = '', onChange, units = [''], placeholder = '' }) => {
      const parseValue = (v) => {
        if (!v) return { num: '', unit: units[0] || '' };
        const sorted = [...units].sort((a,b) => b.length - a.length);
        for (const u of sorted) { if (v.endsWith(u)) return { num: v.slice(0, -u.length), unit: u }; }
        return { num: v, unit: units[0] || '' };
      };
      const init = parseValue(value);
      const [selectedUnit, setSelectedUnit] = useState(init.unit);
      const [numStr, setNumStr] = useState(init.num);
      const handleNumChange = (n) => { setNumStr(n); onChange(n ? n + selectedUnit : ''); };
      const handleUnitChange = (u) => { setSelectedUnit(u); onChange(numStr ? numStr + u : ''); };
      return (
        <div className="mb-4">
          <label className="block text-sm font-bold text-slate-700 mb-1">{label}</label>
          <div className="flex items-center gap-1">
            <input type="number" min="0" className="flex-1 p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm" placeholder={placeholder || 'æ•°å€¤'} value={numStr} onChange={e => handleNumChange(e.target.value)} />
            {units.length === 1 ? (
              <span className="px-3 py-2 bg-slate-100 border border-slate-300 rounded-md text-sm font-bold text-slate-600 whitespace-nowrap">{units[0]}</span>
            ) : (
              <div className="flex gap-1">
                {units.map(u => (
                  <button key={u} type="button" onClick={() => handleUnitChange(u)}
                    className={`px-2.5 py-2 text-xs font-bold rounded border transition whitespace-nowrap ${selectedUnit === u ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-600 border-slate-300 hover:bg-slate-50'}`}>
                    {u}
                  </button>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    // ======== ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ ========
    const LoginScreen = () => {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [isSignUp, setIsSignUp] = useState(false);
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleSubmit = async () => {
        if (!email || !password) return;
        setLoading(true);
        setError('');
        const { error: err } = isSignUp
          ? await sb.auth.signUp({ email, password })
          : await sb.auth.signInWithPassword({ email, password });
        if (err) setError(err.message);
        setLoading(false);
      };

      const handleKey = (e) => { if (e.key === 'Enter') handleSubmit(); };

      return (
        <div className="min-h-screen bg-slate-100 flex items-center justify-center px-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-slate-800 text-white px-6 py-8 text-center">
              <div className="text-4xl mb-2">ğŸ§­</div>
              <h1 className="text-2xl font-black tracking-tight">é¡§å®¢ã‚«ãƒ«ãƒ†çµ±åˆã‚·ã‚¹ãƒ†ãƒ </h1>
              <p className="text-slate-300 text-sm mt-1">G-House å–¶æ¥­éƒ¨å°‚ç”¨ãƒ„ãƒ¼ãƒ«</p>
            </div>
            <div className="p-6 space-y-4">
              <h2 className="text-center font-black text-slate-700 text-lg">{isSignUp ? 'æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²' : 'ãƒ­ã‚°ã‚¤ãƒ³'}</h2>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" className="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="example@ghouse.jp" value={email} onChange={e => setEmail(e.target.value)} onKeyDown={handleKey} />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-1">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰{isSignUp && <span className="text-slate-400 font-normal text-xs ml-1">ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰</span>}</label>
                <input type="password" className="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value={password} onChange={e => setPassword(e.target.value)} onKeyDown={handleKey} />
              </div>
              {error && <p className="text-red-600 text-sm bg-red-50 border border-red-200 rounded-lg p-3">{error}</p>}
              {isSignUp && <p className="text-xs text-slate-500 bg-blue-50 border border-blue-200 rounded-lg p-3">ç™»éŒ²å¾Œã€å…¥åŠ›ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒå±Šãå ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>}
              <button onClick={handleSubmit} disabled={loading || !email || !password}
                className={`w-full py-3 rounded-xl font-black text-white transition ${loading || !email || !password ? 'bg-slate-300 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 shadow-md'}`}>
                {loading ? 'å‡¦ç†ä¸­...' : isSignUp ? 'ç™»éŒ²ã™ã‚‹' : 'ãƒ­ã‚°ã‚¤ãƒ³'}
              </button>
              <button onClick={() => { setIsSignUp(!isSignUp); setError(''); }}
                className="w-full py-2 text-sm text-slate-500 hover:text-blue-600 transition font-bold">
                {isSignUp ? 'â† ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹' : 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯ã“ã¡ã‚‰ â†’'}
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ======== æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« ========
    const NewCustomerModal = ({ onClose, onCreate }) => {
      const [form, setForm] = useState({ staffName: '', belong: '', customerName: '' });
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const valid = form.staffName.trim() && form.belong.trim() && form.customerName.trim();

      const handleCreate = async () => {
        if (!valid) return;
        setLoading(true);
        setError('');
        const err = await onCreate(form);
        if (err) setError(err);
        setLoading(false);
      };

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden">
            <div className="bg-slate-800 text-white px-6 py-4">
              <h2 className="text-lg font-black">æ–°è¦é¡§å®¢ã‚«ãƒ«ãƒ†ä½œæˆ</h2>
              <p className="text-slate-300 text-xs mt-1">ä»¥ä¸‹ã®3é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>
            <div className="p-6 space-y-4">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-1">å–¶æ¥­æ‹…å½“è€…æ°å <span className="text-red-500">*</span></label>
                <input className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" value={form.staffName} onChange={e => setForm(f => ({...f, staffName: e.target.value}))} />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-1">æ‹ ç‚¹ <span className="text-red-500">*</span></label>
                <input className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm" placeholder="ä¾‹ï¼šå¤§é˜ªå–¶æ¥­æ‰€" value={form.belong} onChange={e => setForm(f => ({...f, belong: e.target.value}))} />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-1">ãŠå®¢æ§˜å <span className="text-red-500">*</span></label>
                <input className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm" placeholder="ä¾‹ï¼šç”°ä¸­ æ§˜" value={form.customerName} onChange={e => setForm(f => ({...f, customerName: e.target.value}))} />
              </div>
              {error && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                  <p className="text-red-700 text-xs font-bold">ã‚¨ãƒ©ãƒ¼: {error}</p>
                  {error.includes('relation') && (
                    <p className="text-red-600 text-xs mt-1">â€» Supabaseã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚SQL Editorã§ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆSQLã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
                  )}
                </div>
              )}
            </div>
            <div className="px-6 pb-6 flex gap-3">
              <button onClick={onClose} disabled={loading} className="flex-1 py-3 border border-slate-300 rounded-xl font-bold text-slate-600 hover:bg-slate-50 transition disabled:opacity-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button
                onClick={handleCreate}
                disabled={!valid || loading}
                className={`flex-1 py-3 rounded-xl font-bold text-white transition flex items-center justify-center gap-2 ${valid && !loading ? 'bg-blue-600 hover:bg-blue-700' : 'bg-slate-300 cursor-not-allowed'}`}
              >
                {loading ? 'ä½œæˆä¸­...' : <><IcPlus /> ä½œæˆã™ã‚‹</>}
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ======== å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« ========
    const DeleteModal = ({ customerName, onCancel, onConfirm }) => (
      <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
        <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm mx-4 p-6">
          <p className="text-center font-bold text-slate-700 mb-2">ä»¥ä¸‹ã®ã‚«ãƒ«ãƒ†ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
          <p className="text-center text-lg font-black text-red-600 mb-6">ã€Œ{customerName}ã€æ§˜</p>
          <div className="flex gap-3">
            <button onClick={onCancel} className="flex-1 py-3 border border-slate-300 rounded-xl font-bold text-slate-600 hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={onConfirm} className="flex-1 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700">å‰Šé™¤ã™ã‚‹</button>
          </div>
        </div>
      </div>
    );

    // ======== æ‹ ç‚¹ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« ========
    const BranchManagerModal = ({ branches, onAdd, onDelete, onClose }) => {
      const [newName, setNewName] = useState('');
      const [loading, setLoading] = useState(false);
      const [deleteTarget, setDeleteTarget] = useState(null);

      const handleAdd = async () => {
        const name = newName.trim();
        if (!name) return;
        setLoading(true);
        await onAdd(name);
        setNewName('');
        setLoading(false);
      };

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4">
            <div className="px-6 pt-6 pb-4 border-b border-slate-200">
              <h2 className="text-lg font-black text-slate-800">æ‹ ç‚¹ã®ç®¡ç†</h2>
              <p className="text-xs text-slate-400 mt-0.5">æ‹ ç‚¹ã®è¿½åŠ ãƒ»å‰Šé™¤ãŒã§ãã¾ã™</p>
            </div>

            {/* è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
            <div className="px-6 py-4 border-b border-slate-100">
              <div className="flex gap-2">
                <input
                  className="flex-1 p-2.5 border border-slate-300 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="æ–°ã—ã„æ‹ ç‚¹åã‚’å…¥åŠ›..."
                  value={newName}
                  onChange={e => setNewName(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && handleAdd()}
                />
                <button
                  onClick={handleAdd}
                  disabled={!newName.trim() || loading}
                  className="bg-blue-600 text-white px-4 py-2 rounded-xl font-bold text-sm hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition"
                >
                  {loading ? '...' : 'è¿½åŠ '}
                </button>
              </div>
            </div>

            {/* æ‹ ç‚¹ä¸€è¦§ */}
            <div className="px-6 py-4 max-h-64 overflow-y-auto">
              {branches.length === 0 ? (
                <p className="text-center text-slate-400 text-sm py-4">æ‹ ç‚¹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
              ) : (
                <ul className="space-y-2">
                  {branches.map(b => (
                    <li key={b.id} className="flex items-center justify-between bg-slate-50 rounded-xl px-4 py-2.5">
                      <span className="font-bold text-slate-700 text-sm">{b.name}</span>
                      {deleteTarget === b.id ? (
                        <div className="flex gap-2">
                          <button onClick={() => setDeleteTarget(null)} className="text-xs text-slate-500 font-bold px-2 py-1 border border-slate-300 rounded-lg hover:bg-white">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                          <button
                            onClick={async () => { await onDelete(b.id); setDeleteTarget(null); }}
                            className="text-xs text-white font-bold px-2 py-1 bg-red-600 rounded-lg hover:bg-red-700"
                          >å‰Šé™¤</button>
                        </div>
                      ) : (
                        <button onClick={() => setDeleteTarget(b.id)} className="text-red-400 hover:text-red-600 transition p-1"><IcTrash /></button>
                      )}
                    </li>
                  ))}
                </ul>
              )}
            </div>

            <div className="px-6 pb-6">
              <button onClick={onClose} className="w-full py-3 border border-slate-300 rounded-xl font-bold text-slate-600 hover:bg-slate-50 transition">é–‰ã˜ã‚‹</button>
            </div>
          </div>
        </div>
      );
    };

    // ======== é¡§å®¢ä¸€è¦§ç”»é¢ ========
    const CustomerList = ({ customers, onNew, onEdit, onDelete, onLogout, userEmail, dbLoading, branches, onAddBranch, onDeleteBranch }) => {
      const [search, setSearch] = useState('');
      const [deleteTarget, setDeleteTarget] = useState(null);
      const [selectedBranch, setSelectedBranch] = useState('all');
      const [showBranchMgr, setShowBranchMgr] = useState(false);

      const filtered = customers.filter(c => {
        const matchSearch = c.customerName.includes(search) || c.staffName.includes(search) || c.belong.includes(search);
        const matchBranch = selectedBranch === 'all' || c.belong === selectedBranch;
        return matchSearch && matchBranch;
      });

      return (
        <div className="min-h-screen bg-slate-100 font-sans">
          {deleteTarget && (
            <DeleteModal
              customerName={deleteTarget.customerName}
              onCancel={() => setDeleteTarget(null)}
              onConfirm={() => { onDelete(deleteTarget.id); setDeleteTarget(null); }}
            />
          )}
          {showBranchMgr && (
            <BranchManagerModal
              branches={branches}
              onAdd={onAddBranch}
              onDelete={onDeleteBranch}
              onClose={() => setShowBranchMgr(false)}
            />
          )}
          <div className="max-w-5xl mx-auto px-4 py-8">
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6">
              <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div className="flex items-center gap-3">
                  <span className="text-blue-600"><IcGrid /></span>
                  <div>
                    <h1 className="text-2xl font-black text-slate-800 tracking-tight">ğŸ§­ é¡§å®¢ã‚«ãƒ«ãƒ†çµ±åˆã‚·ã‚¹ãƒ†ãƒ </h1>
                    <p className="text-sm text-slate-500 mt-0.5">G-House å–¶æ¥­éƒ¨å°‚ç”¨ãƒ„ãƒ¼ãƒ«</p>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <div className="text-right hidden md:block">
                    <p className="text-xs text-slate-400">ãƒ­ã‚°ã‚¤ãƒ³ä¸­</p>
                    <p className="text-sm font-bold text-slate-600">{userEmail}</p>
                  </div>
                  <button onClick={onLogout} className="border border-slate-300 text-slate-600 px-4 py-2.5 rounded-xl font-bold text-sm hover:bg-slate-50 transition">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                  <button onClick={onNew} className="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-blue-700 transition shadow-md">
                    <IcPlus /> æ–°è¦ã‚«ãƒ«ãƒ†ä½œæˆ
                  </button>
                </div>
              </div>
            </div>

            {/* æ‹ ç‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
            <div className="mb-4 flex items-center gap-2">
              <div className="flex gap-2 flex-wrap flex-1">
                <button
                  onClick={() => setSelectedBranch('all')}
                  className={`px-4 py-2 rounded-full text-sm font-bold transition border ${selectedBranch === 'all' ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-white text-slate-600 border-slate-300 hover:bg-slate-50'}`}
                >
                  å…¨ã¦ ({customers.length})
                </button>
                {branches.map(b => {
                  const count = customers.filter(c => c.belong === b.name).length;
                  return (
                    <button
                      key={b.id}
                      onClick={() => setSelectedBranch(b.name)}
                      className={`px-4 py-2 rounded-full text-sm font-bold transition border ${selectedBranch === b.name ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-white text-slate-600 border-slate-300 hover:bg-slate-50'}`}
                    >
                      {b.name} ({count})
                    </button>
                  );
                })}
              </div>
              <button
                onClick={() => setShowBranchMgr(true)}
                className="p-2 border border-slate-300 text-slate-500 rounded-xl hover:bg-slate-50 hover:text-slate-700 transition flex-shrink-0"
                title="æ‹ ç‚¹ã‚’ç®¡ç†"
              >
                <IcSettings />
              </button>
            </div>

            {/* æ¤œç´¢ */}
            <div className="mb-4">
              <input
                className="w-full p-3 border border-slate-300 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-sm"
                placeholder="ğŸ” ãŠå®¢æ§˜åãƒ»æ‹…å½“è€…åãƒ»æ‹ ç‚¹ã§æ¤œç´¢..."
                value={search}
                onChange={e => setSearch(e.target.value)}
              />
            </div>

            {/* ä»¶æ•° */}
            <p className="text-xs text-slate-400 mb-3 px-1">
              {dbLoading ? 'èª­ã¿è¾¼ã¿ä¸­...' : `${filtered.length} ä»¶ã®ã‚«ãƒ«ãƒ†`}
            </p>

            {/* ä¸€è¦§ */}
            {filtered.length === 0 ? (
              <div className="bg-white rounded-2xl border border-slate-200 p-16 text-center">
                <div className="text-5xl mb-4">ğŸ“‹</div>
                <p className="text-slate-500 font-bold">{(search || selectedBranch !== 'all') ? 'æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' : 'ã‚«ãƒ«ãƒ†ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“'}</p>
                {!search && selectedBranch === 'all' && <p className="text-slate-400 text-sm mt-2">ã€Œæ–°è¦ã‚«ãƒ«ãƒ†ä½œæˆã€ãƒœã‚¿ãƒ³ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„</p>}
              </div>
            ) : (
              <div className="space-y-3">
                {filtered.map(c => (
                  <div key={c.id} className="bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition overflow-hidden">
                    <div className="flex items-center gap-4 p-4">
                      {/* ãƒ¡ã‚¤ãƒ³æƒ…å ± */}
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 flex-wrap">
                          <span className="text-lg font-black text-slate-800">{c.customerName} æ§˜</span>
                          <span className="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-0.5 rounded-full">{c.belong}</span>
                        </div>
                        <div className="flex items-center gap-4 mt-1 text-sm text-slate-500">
                          <span>æ‹…å½“: <span className="font-bold text-slate-700">{c.staffName}</span></span>
                          <span className="text-slate-300">|</span>
                          <span>ä½œæˆ: {new Date(c.createdAt).toLocaleDateString('ja-JP')}</span>
                          <span className="text-slate-300">|</span>
                          <span>æ›´æ–°: {new Date(c.updatedAt).toLocaleDateString('ja-JP')} {new Date(c.updatedAt).toLocaleTimeString('ja-JP', {hour:'2-digit', minute:'2-digit'})}</span>
                        </div>
                        {c.karteData.sheetHeader.targetDate && (
                          <span className="text-xs text-orange-600 font-bold mt-1 inline-block">å¥‘ç´„ç›®æ¨™æ—¥: {c.karteData.sheetHeader.targetDate}ã€€ãƒ©ãƒ³ã‚¯: {c.karteData.sheetHeader.rank}</span>
                        )}
                      </div>
                      {/* æ“ä½œãƒœã‚¿ãƒ³ */}
                      <div className="flex items-center gap-2 flex-shrink-0">
                        <button
                          onClick={() => onEdit(c.id)}
                          className="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-1.5 hover:bg-blue-700 transition"
                        >
                          <IcEdit /> é–‹ã
                        </button>
                        <button
                          onClick={() => setDeleteTarget(c)}
                          className="border border-red-200 text-red-500 px-3 py-2 rounded-lg font-bold text-sm flex items-center gap-1.5 hover:bg-red-50 transition"
                        >
                          <IcTrash />
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <footer className="mt-10 text-center text-slate-400 text-[10px] pb-6">
              <p>Â© G-House Internal Sales System | Version Final</p>
            </footer>
          </div>
        </div>
      );
    };

    // ======== ã‚«ãƒ«ãƒ†ç·¨é›†ç”»é¢ ========
    const KarteEditor = ({ customer, onBack, onSave, onUpdateInfo }) => {
      const [activeTab, setActiveTab] = useState('flow');
      const [data, setData] = useState(customer.karteData);
      const [saveMsg, setSaveMsg] = useState('');
      const [infoEdit, setInfoEdit] = useState(false);
      const [infoForm, setInfoForm] = useState({ staffName: customer.staffName, belong: customer.belong, customerName: customer.customerName });
      const [infoSaving, setInfoSaving] = useState(false);
      const [infoErr, setInfoErr] = useState('');

      const handleSaveInfo = async () => {
        if (!infoForm.staffName.trim() || !infoForm.belong.trim() || !infoForm.customerName.trim()) return;
        setInfoSaving(true); setInfoErr('');
        const err = await onUpdateInfo(customer.id, infoForm);
        if (err) setInfoErr(err);
        else setInfoEdit(false);
        setInfoSaving(false);
      };

      const cancelInfoEdit = () => {
        setInfoForm({ staffName: customer.staffName, belong: customer.belong, customerName: customer.customerName });
        setInfoErr('');
        setInfoEdit(false);
      };

      const updateNested = (tab, cat, field, val) =>
        setData(prev => ({ ...prev, [tab]: { ...prev[tab], [cat]: { ...prev[tab][cat], [field]: val } } }));

      const updateArrayItem = (tab, arrayName, index, field, val) => {
        const arr = [...data[tab][arrayName]];
        arr[index] = { ...arr[index], [field]: val };
        setData(prev => ({ ...prev, [tab]: { ...prev[tab], [arrayName]: arr } }));
      };

      const updateList = (tab, listName, id, val) =>
        setData(prev => ({
          ...prev,
          [tab]: { ...prev[tab], [listName]: prev[tab][listName].map(item => item.id === id ? { ...item, note: val } : item) }
        }));

      const handleSave = () => {
        onSave(customer.id, data);
        setSaveMsg('ä¿å­˜ã—ã¾ã—ãŸ âœ…');
        setTimeout(() => setSaveMsg(''), 2500);
      };

      const th = "border border-slate-300 bg-slate-100 p-1 text-[10px] font-bold text-center";
      const td = "border border-slate-300 p-1 text-[10px] min-h-[1.5rem]";
      // å˜ä½ä»˜ãè¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼šæ—¢ã«å˜ä½ãŒã‚ã‚Œã°ãã®ã¾ã¾ã€ãªã‘ã‚Œã°ä»˜ä¸
      const wu = (v, unit) => {
        if (!v) return '';
        const known = ['ä¸‡å††/æœˆ', 'ä¸‡å††', 'æ­³', 'å¹´', 'æ™‚é–“', 'åˆ†'];
        if (known.some(u => String(v).endsWith(u))) return v;
        return v + unit;
      };

      const tabs = [
        { key: 'flow',    label: 'å•†è«‡ãƒ•ãƒ­ãƒ¼',     color: 'indigo' },
        { key: 'summary', label: 'ã‚«ãƒ«ãƒ†ä¸€è¦§',     color: 'emerald' },
        { key: 'basic',   label: 'åŸºæœ¬æƒ…å ±',       color: 'blue' },
        { key: 'general', label: 'ç·åˆãƒ’ã‚¢ãƒªãƒ³ã‚°', color: 'blue' },
        { key: 'land',    label: 'åœŸåœ°ã‚¨ãƒªã‚¢ç²¾æŸ»', color: 'blue' },
      ];
      const tabColor = {
        indigo: 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50',
        emerald: 'text-emerald-600 border-b-2 border-emerald-600 bg-emerald-50/50',
        blue: 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/30',
      };

      return (
        <div className="min-h-screen bg-slate-100 py-4 px-4 font-sans">
          <div className="max-w-5xl mx-auto">

            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-4 no-print">
              <div className="p-4 flex flex-col md:flex-row md:items-center justify-between gap-3">
                <div className="flex items-center gap-3">
                  <button onClick={onBack} className="flex items-center gap-1.5 text-slate-600 hover:text-slate-800 font-bold text-sm border border-slate-200 px-3 py-2 rounded-lg hover:bg-slate-50 transition">
                    <IcBack /> ä¸€è¦§ã¸æˆ»ã‚‹
                  </button>
                  {infoEdit ? (
                    <div className="space-y-2">
                      <div className="flex gap-2 flex-wrap items-center">
                        <input
                          value={infoForm.customerName}
                          onChange={e => setInfoForm(p => ({ ...p, customerName: e.target.value }))}
                          className="border border-slate-300 rounded-lg px-2 py-1 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 w-40"
                          placeholder="ãŠå®¢æ§˜å"
                        />
                        <input
                          value={infoForm.belong}
                          onChange={e => setInfoForm(p => ({ ...p, belong: e.target.value }))}
                          className="border border-slate-300 rounded-lg px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-blue-500 w-28"
                          placeholder="æ‹ ç‚¹"
                        />
                        <input
                          value={infoForm.staffName}
                          onChange={e => setInfoForm(p => ({ ...p, staffName: e.target.value }))}
                          className="border border-slate-300 rounded-lg px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-blue-500 w-28"
                          placeholder="æ‹…å½“è€…å"
                        />
                      </div>
                      {infoErr && <p className="text-red-500 text-xs">{infoErr}</p>}
                      <div className="flex gap-2">
                        <button onClick={handleSaveInfo} disabled={infoSaving} className="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-blue-700 disabled:opacity-50 transition">
                          {infoSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ã™ã‚‹'}
                        </button>
                        <button onClick={cancelInfoEdit} className="border border-slate-300 px-3 py-1 rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-50 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                      </div>
                    </div>
                  ) : (
                    <div>
                      <p className="text-xs text-slate-400">{customer.belong}ã€€æ‹…å½“: {customer.staffName}</p>
                      <div className="flex items-center gap-1.5">
                        <h1 className="text-xl font-black text-slate-800">{customer.customerName} æ§˜ã®ã‚«ãƒ«ãƒ†</h1>
                        <button onClick={() => { setInfoForm({ staffName: customer.staffName, belong: customer.belong, customerName: customer.customerName }); setInfoEdit(true); }} className="text-slate-400 hover:text-slate-600 transition p-1" title="åŸºæœ¬æƒ…å ±ã‚’ç·¨é›†">
                          <IcEdit />
                        </button>
                      </div>
                    </div>
                  )}
                </div>
                <div className="flex items-center gap-2">
                  {saveMsg && <span className="text-green-600 font-bold text-sm bg-green-50 px-3 py-1.5 rounded-lg border border-green-200">{saveMsg}</span>}
                  <button onClick={handleSave} className="bg-emerald-600 text-white px-4 py-2.5 rounded-xl font-bold flex items-center gap-2 hover:bg-emerald-700 transition shadow-md">
                    <IcSave /> ä¸€æ™‚ä¿å­˜
                  </button>
                  <button onClick={() => window.print()} className="bg-slate-800 text-white px-4 py-2.5 rounded-xl font-bold flex items-center gap-2 hover:bg-slate-700 transition shadow-md">
                    <IcPrint /> å°åˆ·
                  </button>
                </div>
              </div>
              <div className="flex border-t border-slate-100 overflow-x-auto bg-slate-50/50">
                {tabs.map(({ key, label, color }) => (
                  <button key={key} onClick={() => setActiveTab(key)}
                    className={`flex-1 min-w-[100px] py-3 text-xs font-bold ${activeTab === key ? tabColor[color] : 'text-slate-500 hover:text-slate-700'}`}>
                    {label}
                  </button>
                ))}
              </div>
            </div>

            {/* ======== å•†è«‡ãƒ•ãƒ­ãƒ¼ ======== */}
            {activeTab === 'flow' && (
              <div className="space-y-4">
                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="bg-slate-700 text-white px-6 py-3 flex items-center gap-2">
                    <span className="bg-white text-slate-700 font-black text-xs px-2 py-0.5 rounded">STEP 1</span>
                    <span className="font-black text-base">ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚º</span>
                    <span className="text-slate-300 text-xs ml-2">â€• å„ã‚¿ãƒ–ã«æ²¿ã£ã¦é †ç•ªã«èã â€•</span>
                  </div>
                  <div className="p-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
                    {["â‘  ç¾åœ¨ã®ãŠä½ã¾ã„ï¼ˆã‚¨ãƒªã‚¢ãƒ»è³ƒè²¸ or æŒå®¶ï¼‰","â‘¡ å°†æ¥çš„ã«ã”å…¥å±…äºˆå®šã®äººæ•°","â‘¢ ãŠå®¶ã¥ãã‚Šã‚’è€ƒãˆå§‹ã‚ãŸãã£ã‹ã‘","â‘£ Gãƒã‚¦ã‚¹ã‚’çŸ¥ã£ã¦ã„ãŸã ã„ãŸãã£ã‹ã‘","â‘¤ ãŠåœŸåœ°ã«ã¤ã„ã¦","â‘¥ ãŠå®¶ã«ã¤ã„ã¦","â‘¦ ã”å…¥å±…äºˆå®šæ™‚æœŸ"].map((t, i) => (
                      <div key={i} className="flex items-center gap-3 bg-slate-50 rounded-lg px-4 py-3 border border-slate-200">
                        <span className="w-7 h-7 rounded-full bg-slate-600 text-white flex items-center justify-center font-black text-xs flex-shrink-0">{i+1}</span>
                        <span className="font-bold text-slate-700 text-sm">{t}</span>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-indigo-700 text-white rounded-xl shadow-lg overflow-hidden">
                  <div className="px-6 py-3 bg-indigo-900 flex items-center gap-2">
                    <span className="bg-white text-indigo-900 font-black text-xs px-2 py-0.5 rounded">STEP 2</span>
                    <span className="font-black text-base">ææ¡ˆã¸ã®å…¥ã‚Šå£ã€€â€• ã¾ãšã“ã‚Œã‚’èã â€•</span>
                  </div>
                  <div className="p-6">
                    <div className="text-center bg-white/10 rounded-xl p-5 mb-3">
                      <p className="text-xl font-black tracking-wide leading-relaxed">ã€ŒåœŸåœ°ãƒ»å»ºç‰©ã€ã™ã¹ã¦ç†æƒ³ãŒå¶ã†ã¨ã—ãŸã‚‰</p>
                      <p className="text-2xl font-black text-yellow-300 mt-1">æœˆã€…ã„ãã‚‰ã¾ã§å‡ºã›ã¾ã™ã‹ï¼Ÿã€</p>
                    </div>
                    <div className="bg-red-500/80 rounded-lg px-4 py-2 text-sm font-bold text-center">
                      âš ï¸ ã€Œã„ãã‚‰ãŒè‰¯ã„ã§ã™ã‹ï¼Ÿã€ã¯NG â€• å¿…ãš <span className="underline">å‡ºã™ä¾¡å€¤ã®ã‚ã‚‹é‡‘é¡</span> ã‚’èãå‡ºã™
                    </div>
                    <p className="text-indigo-200 text-xs text-center mt-2">ã“ã®è³ªå•ãŒç­”ãˆã‚‰ã‚ŒãŸã‚‰æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸é€²ã‚ã‚‹ âœ…</p>
                  </div>
                </div>

                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="bg-blue-600 text-white px-6 py-3 flex items-center gap-2">
                    <span className="bg-white text-blue-600 font-black text-xs px-2 py-0.5 rounded">STEP 3</span>
                    <span className="font-black text-base">å›³é¢æå‡º ï¼‹ è³‡é‡‘è©¦ç®—</span>
                  </div>
                  <div className="p-5 space-y-3">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p className="font-black text-blue-800 mb-2">ğŸ“ å»ºç‰©å‚è€ƒå›³é¢ã®æå‡º</p>
                        <ul className="text-sm text-blue-700 space-y-1">
                          <li>ãƒ» ç†æƒ³ã«è¿‘ã„é–“å–ã‚Šã‚’æç¤º</li>
                          <li>ãƒ» ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿã‚’ä¸€ç·’ã«ç¢ºèªãƒ»å…±æœ‰</li>
                          <li>ãƒ» åªæ•°ã‚’ã‚‚ã¨ã«å»ºç‰©ã§è³‡é‡‘è¨ˆç”»è©¦ç®—</li>
                        </ul>
                      </div>
                      <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                        <p className="font-black text-green-800 mb-2">ğŸ—ºï¸ åœŸåœ°äºˆç®—ã®è©¦ç®—</p>
                        <ul className="text-sm text-green-700 space-y-1">
                          <li>ãƒ» å¸Œæœ›ã‚¨ãƒªã‚¢ ï¼‹ é§…è·é›¢ ï¼‹ åªæ•°ã‚’ã‚‚ã¨ã«</li>
                          <li>ãƒ» åœŸåœ°äºˆç®—ã‚’å–ã£ã¦è©¦ç®—ã™ã‚‹</li>
                          <li>ãƒ» ãƒˆãƒ¼ã‚¿ãƒ«ã®æœˆã€…æ”¯æ‰•ã„ã‚’ç®—å‡º</li>
                        </ul>
                      </div>
                    </div>
                    <div className="bg-yellow-50 border border-yellow-300 rounded-lg p-3 text-center">
                      <p className="font-black text-yellow-800 text-sm">ã€Œã“ã®é‡‘é¡ã‚’è¦‹ã¦ã€ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿã€â† å¿…ãšåå¿œã‚’ç¢ºèªã™ã‚‹</p>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="bg-emerald-600 text-white px-6 py-3 flex items-center gap-2">
                    <span className="bg-white text-emerald-600 font-black text-xs px-2 py-0.5 rounded">STEP 4</span>
                    <span className="font-black text-base">æœˆã€…ã«è½ã¨ã—è¾¼ã‚€å·¥å¤«ã®è©±</span>
                  </div>
                  <div className="p-5">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                      {['ğŸ’° é ­é‡‘', 'ğŸ“… ãƒ­ãƒ¼ãƒ³å¹´æ•°', 'ğŸ ãƒœãƒ¼ãƒŠã‚¹æ‰•ã„', 'ğŸ¤ æ´åŠ©'].map((item, i) => (
                        <div key={i} className="bg-emerald-50 border border-emerald-200 rounded-lg p-3 text-center">
                          <p className="font-black text-emerald-800 text-sm">{item}</p>
                        </div>
                      ))}
                    </div>
                    <div className="bg-slate-800 text-white rounded-lg p-4 mb-3">
                      <p className="font-black text-yellow-300 mb-2">ğŸ”¥ å…‰ç†±è²»é€†è»¢ç¾è±¡ã‚’å¿…ãšè¦‹ã›ã‚‹</p>
                      <p className="text-sm leading-relaxed">ãƒ­ãƒ¼ã‚³ã‚¹ãƒˆã§ <span className="text-yellow-300 font-bold">500ã€œ1,000ä¸‡å††å®‰ã</span> ã¦ã‚‚ã€å…‰ç†±è²»ãŒ <span className="text-red-400 font-bold">æœˆ2ã€œ3ä¸‡å††</span> ã‹ã‹ã‚‹ã¨â€¦<br/>â†’ <span className="text-white font-black">35å¹´ã§840ã€œ1,260ä¸‡å††ã®å·®</span> ãŒç”Ÿã¾ã‚Œã€<span className="text-yellow-300 font-bold">é€†è»¢ã™ã‚‹ï¼</span></p>
                    </div>
                    <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-3 text-center">
                      <p className="font-black text-indigo-800">ã€ŒGãƒã‚¦ã‚¹ã®æ–¹ãŒ <span className="text-indigo-600">å®¶ã®è³ªãŒé«˜ã</span>ã€æœˆã€…ã®æ”¯æ‰•ã„ã‚‚ <span className="text-indigo-600">æ¥½ã«ãªã‚‹</span>ã€</p>
                      <p className="text-xs text-indigo-600 mt-1">ã“ã‚Œã‚’ã—ã£ã‹ã‚Šç†è§£ã•ã›ã¦ã‹ã‚‰ â†“</p>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="bg-orange-500 text-white px-6 py-3 flex items-center gap-2">
                    <span className="bg-white text-orange-500 font-black text-xs px-2 py-0.5 rounded">STEP 5</span>
                    <span className="font-black text-base">ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æç¤º ï¼‹ é¸æŠè‚¢ã®åºƒãŒã‚Šã‚’è¦‹ã›ã‚‹</span>
                  </div>
                  <div className="p-5 space-y-3">
                    <div className="bg-red-50 border-l-4 border-red-500 rounded-r-lg p-3">
                      <p className="font-black text-red-700 text-sm">âš ï¸ é–“é•ã£ã¦ã‚‚ã™ãã«ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’æç¤ºã—ãªã„</p>
                      <p className="text-xs text-red-600 mt-1">Gãƒã‚¦ã‚¹ã®ä¾¡å€¤ã‚’ç†è§£ã•ã›ãŸå¾Œã§åˆã‚ã¦æç¤ºã™ã‚‹</p>
                    </div>
                    <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                      <p className="font-black text-orange-800 mb-2">ä¾‹ï¼‰500ä¸‡å††ä¸‹ã’ãŸçµæœã‚’è¦‹ã›ã‚‹</p>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                        {[['åœŸåœ°äºˆç®—ã«å……å½“','200ã€œ300ä¸‡å††'],['å»ºç‰©OPã«å……å½“','100ä¸‡å††'],['æœˆã€…ã‚’ä¸‹ã’ã‚‹','æ§˜ã€…ãªé¸æŠè‚¢']].map(([t,s],i) => (
                          <div key={i} className="bg-white border border-orange-200 rounded p-2 text-center text-sm">
                            <p className="font-bold text-orange-700">{t}</p>
                            <p className="text-xs text-slate-500">{s}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                    <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                      <p className="font-black text-green-800 text-sm">âœ… åœŸåœ°äºˆç®—ã‚’å°‘ã—å¢—ã‚„ã—ã¦ â†’ æ¬¡å› ã„ãˆãƒ—ãƒ­ ã¸ãƒãƒˆãƒ³ã‚’æ¸¡ã™</p>
                      <p className="text-xs text-green-700 mt-1">ã‚®ãƒªã‚®ãƒªã§ã¯ãªãå°‘ã—ä½™è£•ã‚’æŒã£ãŸäºˆç®—ã§åœŸåœ°ã‚’æ±ºã‚ã‚„ã™ãã™ã‚‹ã€‚é«˜ã„åœŸåœ°ã§ã‚‚ã€ŒGãƒã‚¦ã‚¹ã®æ–¹ãŒå®‰ã„ã€ã¨ç†è§£æ¸ˆã¿ãªã®ã§ä¹—ã‚Šè¶Šãˆã‚„ã™ã„ã€‚</p>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="bg-slate-600 text-white px-6 py-3 flex items-center gap-2">
                    <span className="bg-white text-slate-600 font-black text-xs px-2 py-0.5 rounded">STEP 6</span>
                    <span className="font-black text-base">äºˆç®—æ„ŸãŒå³ã—ã„å ´åˆã®å¯¾å¿œ</span>
                  </div>
                  <div className="p-5">
                    <p className="text-sm text-slate-600 mb-3 font-bold">ã€Œç¾çŠ¶ã®äºˆç®—ã ã¨ã€ä»Šã®ã‚¨ãƒªã‚¢ã¯å³ã—ã„çŠ¶æ…‹ã§ã™ã€‚ä¾‹ãˆã°ã“ã‚Œã¯ã©ã†ã§ã™ã‹ï¼Ÿã€<br/><span className="text-xs font-normal text-slate-500">ä¸€ã¤ãšã¤ä¸å¯§ã«ç¢ºèªãƒ»åŒæ„ã‚’å–ã‚ŠãªãŒã‚‰é€²ã‚ã‚‹ï¼ˆæŠ¼ã—ä»˜ã‘ãªã„ï¼‰</span></p>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2 mb-4">
                      {[['ğŸ—¾','åœŸåœ°ã‚¨ãƒªã‚¢ã‚’å¤‰ãˆã‚‹'],['ğŸ ','å•†å“ã‚’å¤‰ãˆã‚‹'],['ğŸ“','å»ºç‰©åªæ•°ã‚’å·¥å¤«'],['ğŸ’¹','äºˆç®—ã‚’ä¸Šã’ã‚‹'],['ğŸ’°','é ­é‡‘ã‚’å‡ºã™'],['ğŸ¤','æ´åŠ©ã‚’ä½¿ã†']].map(([ic,lb],i) => (
                        <div key={i} className="bg-slate-50 border border-slate-200 rounded-lg p-3 flex items-center gap-2">
                          <span className="text-lg">{ic}</span>
                          <span className="text-sm font-bold text-slate-700">{lb}</span>
                        </div>
                      ))}
                    </div>
                    <div className="space-y-2">
                      <div className="bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-800">
                        <span className="font-black">å…¨éƒ¨è­²ã‚Œãªã„äººã¯è¿½ã‚ãªã„ã€‚</span><br/>
                        ã€Œã¾ãŸä¸€åº¦ã”æ¤œè¨ã„ãŸã ãã€å¤‰åŒ–ãŒã‚ã‚Œã°é€£çµ¡ãã ã•ã„ ğŸ˜Šã€ã§ãŠåˆ¥ã‚Œ
                      </div>
                      <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-3 text-sm text-indigo-800">
                        <p className="font-black mb-1">æ•´ç†ã™ã¹ã3æŠã‚’æ˜ç¢ºã«ä¼ãˆã‚‹ï¼š</p>
                        <p>ğŸ  <span className="font-bold">ã„ã„å®¶</span> ã«ä½ã¿ãŸã„ã®ã‹ï¼Ÿã€€ğŸ—¾ <span className="font-bold">ã„ã„åœŸåœ°</span> ã«ä½ã¿ãŸã„ã®ã‹ï¼Ÿ</p>
                        <p className="mt-1">ã©ã¡ã‚‰ã‚‚è­²ã‚Œãªã„ãªã‚‰ â†’ <span className="font-black text-indigo-700">äºˆç®—ã‚’ä¸Šã’ã‚‹ã ã‘</span></p>
                        <p className="mt-2 text-xs font-bold text-indigo-600">ã€Œé•·ãä½ã‚€å ´æ‰€ã¯åœŸåœ°ã§ã¯ãªãã€å®¶ã§ã™ã€â† ã“ã“ã‚’ç†è§£ã•ã›ã‚‹</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="bg-purple-600 text-white px-6 py-3 flex items-center gap-2">
                    <span className="bg-white text-purple-600 font-black text-xs px-2 py-0.5 rounded">STEP 7</span>
                    <span className="font-black text-base">æ¬¡å›ã‚¢ãƒã‚¤ãƒ³ãƒˆã¸ â€• ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å…¨ä½“åƒã‚’å…±æœ‰</span>
                  </div>
                  <div className="p-5">
                    <p className="text-sm font-bold text-slate-600 mb-3">ãŠé‡‘ã®è©±ãŒå®Œäº†ã—ãŸã‚‰ã€å…¨ä½“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å…±æœ‰ã—ã¦ã‹ã‚‰æ¬¡å›ã®ç´„æŸã¸é€²ã‚ã‚‹</p>
                    <div className="space-y-2">
                      {[
                        { icon:'ğŸ“–', title:'ã‚¹ã‚¿ã‚¤ãƒ«ãƒ–ãƒƒã‚¯ã‚’ã‚‚ã¨ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³é‡‘é¡ã®æ•´ç†', note:'' },
                        { icon:'ğŸ—¾', title:'å¸Œæœ›ã‚¨ãƒªã‚¢ã®åœŸåœ°ç‰©ä»¶ã«ã¤ã„ã¦å…±æœ‰', note:'ãƒ¬ã‚¤ãƒ³ã‚ºã§ç›¸å ´è¦³ã®æŠŠæ¡ã®ã¿ã§OKã€‚ã„ãˆãƒ—ãƒ­ä¸å‹•ç”£ã¯å»ºç¯‰ç”³è¾¼ã‚’ã„ãŸã ã„ã¦ã‹ã‚‰ç´¹ä»‹ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚ç¾åœ¨ã®äºˆç®—å–ã‚Šã§åœŸåœ°ã‚’æ¢ã—ã¦ã„ã‘ãã†ã‹ç¢ºèªã™ã‚‹ç¨‹åº¦ã€‚\nâ€»æ±ºã‚ç‰©ãŒã‚ã‚Œã°ææ¡ˆï¼ãŸã ã—å®¶ãŒæ°—ã«å…¥ã£ã¦ã„ãªã„çŠ¶æ…‹ã§åœŸåœ°ææ¡ˆã‚’ã™ã‚‹ã¨ãƒ¡ãƒ¼ã‚«ãƒ¼æ±ºå®šã®æ±ºæ–­ãŒã§ããªã„ã¾ã¾ãšã‚‹ãšã‚‹é€²ã‚€ã€‚ä»–ç¤¾ã®æ¨ªã‚„ã‚Šã§åœŸåœ°ã”ã¨æŒã£ã¦ã„ã‹ã‚Œã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã€‚' },
                        { icon:'ğŸ¦', title:'äº‹å‰å¯©æŸ»ã®ä¾é ¼ï¼ˆã§ãã‚‹äººã¯ã‚¤ã‚ªãƒ³éŠ€è¡Œãªã©ã§ï¼‰', note:'æ¬¡å›ã¾ã§ã«URLã®ã¿é€ä»˜ã—ã¦ã‚ã’ã‚‹' },
                      ].map((item, i) => (
                        <div key={i} className="bg-purple-50 border border-purple-200 rounded-lg p-3">
                          <p className="font-black text-purple-800 text-sm">{item.icon} {item.title}</p>
                          {item.note && <p className="text-xs text-purple-600 mt-1 leading-relaxed whitespace-pre-line">{item.note}</p>}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* ======== ã‚«ãƒ«ãƒ†ä¸€è¦§ï¼ˆå°åˆ·ç”¨ï¼‰ ======== */}
            {activeTab === 'summary' && (
              <div className="bg-white p-6 shadow-2xl rounded-sm border border-slate-300 overflow-auto">
                <div className="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200 no-print">
                  <InputField label="å¥‘ç´„ç›®æ¨™æ—¥" value={data.sheetHeader.targetDate} onChange={(v) => setData(p => ({...p, sheetHeader: {...p.sheetHeader, targetDate: v}}))} />
                  <InputField label="ãƒ©ãƒ³ã‚¯" value={data.sheetHeader.rank} onChange={(v) => setData(p => ({...p, sheetHeader: {...p.sheetHeader, rank: v}}))} />
                </div>

                <div className="text-[11px] border border-black karte-outer">
                  <div className="flex justify-between items-center bg-slate-800 text-white px-4 py-2">
                    <div className="font-black text-base tracking-widest">ğŸ§­ ãŠå®¢æ§˜æƒ…å ±ã‚«ãƒ«ãƒ†ã€€ver2.3</div>
                    <div className="text-[10px] text-right space-y-0.5">
                      <div>æ‰€å±: <span className="font-bold">{customer.belong}</span>ã€€æ‹…å½“: <span className="font-bold">{customer.staffName}</span></div>
                      <div>å¥‘ç´„ç›®æ¨™æ—¥: <span className="font-bold">{data.sheetHeader.targetDate}</span>ã€€ãƒ©ãƒ³ã‚¯: <span className="font-bold">{data.sheetHeader.rank}</span>ã€€è¨˜å…¥æ—¥: {new Date().toLocaleDateString()}</div>
                    </div>
                  </div>
                  <div className="bg-indigo-50 px-4 py-2 border-b border-black text-center">
                    <span className="text-lg font-black text-slate-800 tracking-widest">{customer.customerName || 'ã€€ã€€ã€€ã€€'} æ§˜</span>
                  </div>

                  <div className="border-b border-black sec-hd pao"><div className={`${th} bg-blue-700 text-white text-xs py-1`}>A. åŸºæœ¬æƒ…å ±</div></div>
                  <table className="w-full border-collapse border-b border-black pk">
                    <thead><tr><th className={`${th} w-16`}></th><th className={th}>æ°åï¼ˆãƒ•ãƒªã‚¬ãƒŠï¼‰</th><th className={th}>å¹´é½¢ï¼ˆæ­³ï¼‰</th><th className={th}>é€£çµ¡å…ˆ</th><th className={th}>å¹´åï¼ˆä¸‡å††ï¼‰</th><th className={th}>å‹¤ç¶šå¹´æ•°ï¼ˆå¹´ï¼‰</th></tr></thead>
                    <tbody>
                      <tr><td className={th}>æœ¬äºº</td><td className={td}>{data.basic.rep.name}</td><td className={td}>{wu(data.basic.rep.age,'æ­³')}</td><td className={td}>{data.basic.rep.contact}</td><td className={td}>{wu(data.basic.rep.income,'ä¸‡å††')}</td><td className={td}>{wu(data.basic.rep.years,'å¹´')}</td></tr>
                      <tr><td className={th}>é…å¶è€…</td><td className={td}>{data.basic.partner.name}</td><td className={td}>{wu(data.basic.partner.age,'æ­³')}</td><td className={td}>â€•</td><td className={td}>{wu(data.basic.partner.income,'ä¸‡å††')}</td><td className={td}>{wu(data.basic.partner.years,'å¹´')}</td></tr>
                    </tbody>
                  </table>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-2`}>ç¾ä½æ‰€</div><div className={`${td} col-span-10`}>{data.basic.rep.address}</div>
                  </div>
                  <div className="border-b border-black pk">
                    <div className={`${th} bg-slate-200`}>å®¶æ—æ§‹æˆï¼ˆçˆ¶æ¯ãƒ»ç¾©çˆ¶æ¯ï¼‰</div>
                    <table className="w-full border-collapse">
                      <thead><tr><th className={th}>ç¶šæŸ„</th><th className={th}>å¹´é½¢ï¼ˆæ­³ï¼‰</th><th className={th}>è·æ¥­</th><th className={th}>å¹´åï¼ˆä¸‡å††ï¼‰</th><th className={th}>ç¾åœ¨åŒå±…</th><th className={th}>å°†æ¥åŒå±…</th></tr></thead>
                      <tbody>{data.basic.familyMembers.map((m, i) => (<tr key={i}><td className={`${th} font-bold`}>{m.role}</td><td className={td}>{wu(m.age,'æ­³')}</td><td className={td}>{m.job}</td><td className={td}>{wu(m.income,'ä¸‡å††')}</td><td className={td}>{m.coLiveNow}</td><td className={td}>{m.coLiveFuture}</td></tr>))}</tbody>
                    </table>
                  </div>

                  <div className="border-b border-black pb pao"><div className={`${th} bg-blue-700 text-white text-xs py-1`}>B. ç·åˆãƒ’ã‚¢ãƒªãƒ³ã‚°</div></div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>ã€ç”Ÿæ´»æƒ…å ±ã€‘</div>
                    <div className={`${th} col-span-2`}>ä½å±…å½¢æ…‹</div><div className={`${td} col-span-4`}>{data.general.life.housingType}</div>
                    <div className={`${th} col-span-2`}>æœ€å¯„ã‚Šé§…ï¼ˆæ™‚é–“ï¼‰</div><div className={`${td} col-span-4`}>{data.general.life.station}{data.general.life.stationTime ? 'ã€€' + wu(data.general.life.stationTime,'åˆ†') : ''}</div>
                    <div className={`${th} col-span-2`}>å®¶è³ƒ</div><div className={`${td} col-span-2`}>{wu(data.general.life.rent,'ä¸‡å††/æœˆ')}</div>
                    <div className={`${th} col-span-2`}>é§è»Šå ´</div><div className={`${td} col-span-2`}>{wu(data.general.life.parking,'ä¸‡å††/æœˆ')}</div>
                    <div className={`${th} col-span-2`}>ãã®ä»–è²»ç”¨</div><div className={`${td} col-span-2`}>{wu(data.general.life.otherCost,'ä¸‡å††/æœˆ')}</div>
                    <div className={`${th} col-span-2`}>å®¶æ—æ§‹æˆï¼ˆå°†æ¥å«ã‚€ï¼‰</div><div className={`${td} col-span-4`}>{data.general.life.family}</div>
                    <div className={`${th} col-span-2`}>å®Ÿå®¶å ´æ‰€</div><div className={`${td} col-span-4`}>{data.general.life.homeLoc}</div>
                    <div className={`${th} col-span-2`}>è¶£å‘³</div><div className={`${td} col-span-10`}>{data.general.life.hobby}</div>
                    <div className={`${th} col-span-2 h-12`}>å®¶ã¥ãã‚Šã®ç†ç”±ãƒ»ãã£ã‹ã‘</div><div className={`${td} col-span-10 h-12 whitespace-pre-wrap`}>{data.general.life.reason}</div>
                    <div className={`${th} col-span-2 h-10`}>Gãƒã‚¦ã‚¹ã‚’çŸ¥ã£ãŸãã£ã‹ã‘</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.life.trigger}</div>
                    <div className={`${th} col-span-2 h-10`}>Gãƒã‚¦ã‚¹ã¸ã®é–¢å¿ƒäº‹</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.life.interest}</div>
                    <div className={`${th} col-span-2 h-10`}>æ¤œè¨ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»å°è±¡</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.life.currentMaker}</div>
                  </div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>ã€åœŸåœ°ã€‘</div>
                    <div className={`${th} col-span-2`}>åœŸåœ°æ¢ã—ã®æœ‰ç„¡</div><div className={`${td} col-span-4`}>{data.general.land.hasLand}</div>
                    <div className={`${th} col-span-2`}>å¸Œæœ›ã‚¨ãƒªã‚¢ã¨ç†ç”±</div><div className={`${td} col-span-4`}>{data.general.land.areaReason}</div>
                    <div className={`${th} col-span-2`}>é€šå‹¤å…ˆãƒ»æ–¹æ³•ãƒ»è·é›¢æ„Ÿ</div><div className={`${td} col-span-4`}>{data.general.land.commuteGoal}</div>
                    <div className={`${th} col-span-2`}>å®Ÿå®¶ã¨ã®è·é›¢ãƒ»é–¢ä¿‚</div><div className={`${td} col-span-4`}>{data.general.land.parentsRel}</div>
                    <div className={`${th} col-span-2`}>é§…è·é›¢ã¸ã®è€ƒãˆ</div><div className={`${td} col-span-4`}>{data.general.land.stationThought}</div>
                    <div className={`${th} col-span-2`}>ä»Šã®ä½ã¾ã„ã‚’é¸ã‚“ã ç†ç”±</div><div className={`${td} col-span-4`}>{data.general.land.currentHomeReason}</div>
                    <div className={`${th} col-span-2`}>åœŸåœ°äºˆç®—</div><div className={`${td} col-span-10`}>{wu(data.general.land.landBudget,'ä¸‡å††')}</div>
                  </div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>ã€å»ºç‰©ã€‘</div>
                    <div className={`${th} col-span-2`}>éšæ•°</div><div className={`${td} col-span-2`}>{data.general.building.floors}</div>
                    <div className={`${th} col-span-2`}>éƒ¨å±‹æ•°ãƒ»ç”¨é€”</div><div className={`${td} col-span-6`}>{data.general.building.rooms}</div>
                    <div className={`${th} col-span-2 h-10`}>è¿½åŠ å¸Œæœ›éƒ¨å±‹ã¨ç†ç”±</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.building.extraRooms}</div>
                    <div className={`${th} col-span-2 h-10`}>é–“å–ã‚Šã®ã“ã ã‚ã‚Šãƒ»å›°ã£ã¦ã„ã‚‹ã“ã¨</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.building.layoutPoint}</div>
                    <div className={`${th} col-span-2 h-10`}>ã‚„ã‚ŠãŸã„ã“ã¨ãƒ»ç†ç”±</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.building.goals}</div>
                    <div className={`${th} col-span-2`}>è»Šå°æ•°ãƒ»å„ªå…ˆåº¦</div><div className={`${td} col-span-4`}>{data.general.building.cars}</div>
                    <div className={`${th} col-span-2`}>åº­ã®å¸Œæœ›</div><div className={`${td} col-span-4`}>{data.general.building.garden}</div>
                    <div className={`${th} col-span-2`}>å»ºç‰©äºˆç®—</div><div className={`${td} col-span-10`}>{wu(data.general.building.buildingBudget,'ä¸‡å††')}</div>
                  </div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>ã€è³‡é‡‘è¨ˆç”»ã€‘</div>
                    <div className={`${th} col-span-2`}>ã”ä¸»äººå¹´å</div><div className={`${td} col-span-2`}>{wu(data.general.money.husbandIncome,'ä¸‡å††')}</div>
                    <div className={`${th} col-span-2`}>å¥¥æ§˜å¹´å</div><div className={`${td} col-span-2`}>{wu(data.general.money.wifeIncome,'ä¸‡å††')}</div>
                    <div className={`${th} col-span-2`}>ç·äºˆç®—</div><div className={`${td} col-span-2`}>{wu(data.general.money.totalBudget,'ä¸‡å††')}</div>
                    <div className={`${th} col-span-2`}>é ­é‡‘</div><div className={`${td} col-span-2`}>{wu(data.general.money.downPayment,'ä¸‡å††')}</div>
                    <div className={`${th} col-span-2`}>è²¯é‡‘é¡</div><div className={`${td} col-span-2`}>{wu(data.general.money.savings,'ä¸‡å††')}</div>
                    <div className={`${th} col-span-2`}>æ´åŠ©é‡‘</div><div className={`${td} col-span-2`}>{wu(data.general.money.aid,'ä¸‡å††')}</div>
                    <div className={`${th} col-span-2`}>æœˆã€…å¸Œæœ›é¡</div><div className={`${td} col-span-10`}>{wu(data.general.money.monthlyHope,'ä¸‡å††/æœˆ')}</div>
                    <div className={`${th} col-span-2 h-10`}>æ—¢å­˜å€Ÿå…¥</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.money.existingLoan}</div>
                    <div className={`${th} col-span-2 h-10`}>ç†æƒ³ã®æœˆã€…æ”¯æ‰•ã„ã¨ç†ç”±</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.money.idealPayment}</div>
                    <div className={`${th} col-span-2 h-10`}>å®¶è³ƒã¨ã®å·®ã¸ã®è€ƒãˆ</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.money.rentGap}</div>
                  </div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>ã€å…¥å±…æ™‚æœŸ / ç«¶åˆã€‘</div>
                    <div className={`${th} col-span-2 h-10`}>å¸Œæœ›å…¥å±…æ™‚æœŸãƒ»ç†ç”±</div><div className={`${td} col-span-4 h-10 whitespace-pre-wrap`}>{data.general.time.period}</div>
                    <div className={`${th} col-span-2`}>å…¥å±…ãƒªãƒŸãƒƒãƒˆ</div><div className={`${td} col-span-4`}>{data.general.time.limit}</div>
                    <div className={`${th} col-span-2`}>æ¤œè¨ä»–ç¤¾å</div><div className={`${td} col-span-10`}>{data.general.rival.name}</div>
                    <div className={`${th} col-span-2 h-10`}>ä»–ç¤¾ã®æ°—ã«å…¥ã£ã¦ã„ã‚‹ç‚¹</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.rival.pros}</div>
                    <div className={`${th} col-span-2 h-10`}>ä»–ç¤¾ã¸ã®ä¸æº€ç‚¹</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.rival.cons}</div>
                  </div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>ã€ãƒ†ã‚¹ã‚¯ãƒ­ã€‘</div>
                    <div className={`${th} col-span-2`}>æœ‰ç„¡</div><div className={`${td} col-span-10`}>{data.general.testClose.hasTest}</div>
                    <div className={`${th} col-span-2 h-10`}>ãƒ†ã‚¹ã‚¯ãƒ­çµæœ</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.testClose.result}</div>
                    <div className={`${th} col-span-2 h-10`}>Gãƒã‚¦ã‚¹ã¸ã®ä¸æº€ãƒ»ä¸å®‰</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.testClose.complaints}</div>
                    <div className={`${th} col-span-2 h-10`}>æ¬¡å›ã‚¢ãƒã‚¤ãƒ³ãƒˆ</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.general.testClose.nextDetail}</div>
                  </div>

                  <div className="border-b border-black pb pao"><div className={`${th} bg-blue-700 text-white text-xs py-1`}>C. åœŸåœ°ã‚¨ãƒªã‚¢ç²¾æŸ»</div></div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-2`}>å¸Œæœ›ã‚¨ãƒªã‚¢</div><div className={`${td} col-span-10`}>{data.landDetail.area.target}</div>
                    <div className={`${th} col-span-2 h-10`}>ãªãœãã®ã‚¨ãƒªã‚¢ï¼Ÿ</div><div className={`${td} col-span-10 h-10 whitespace-pre-wrap`}>{data.landDetail.area.whyDeep}</div>
                  </div>
                  <div className="border-b border-black pk">
                    <div className={`${th} bg-slate-200`}>é€šå‹¤äº‹æƒ…</div>
                    <table className="w-full border-collapse">
                      <thead><tr><th className={th}></th><th className={th}>é€šå‹¤å…ˆ</th><th className={th}>æ‰€è¦æ™‚é–“ï¼ˆåˆ†/æ™‚é–“ï¼‰</th><th className={th}>æ–¹æ³•</th><th className={th}>é€šå‹¤ã¸ã®å°è±¡</th><th className={th}>æ¬¡ã¯ã©ã“ã¾ã§è¨±å®¹ï¼Ÿ</th></tr></thead>
                      <tbody>
                        <tr><td className={`${th} text-blue-700`}>ã”ä¸»äººæ§˜</td><td className={td}>{data.landDetail.husband.dest}</td><td className={td}>{wu(data.landDetail.husband.time,'åˆ†')}</td><td className={td}>{data.landDetail.husband.method}</td><td className={td}>{data.landDetail.husband.feeling}</td><td className={td}>{wu(data.landDetail.husband.limit,'åˆ†')}</td></tr>
                        <tr><td className={`${th} text-pink-600`}>å¥¥æ§˜</td><td className={td}>{data.landDetail.wife.dest}</td><td className={td}>{wu(data.landDetail.wife.time,'åˆ†')}</td><td className={td}>{data.landDetail.wife.method}</td><td className={td}>{data.landDetail.wife.feeling}</td><td className={td}>{wu(data.landDetail.wife.limit,'åˆ†')}</td></tr>
                      </tbody>
                    </table>
                  </div>
                  <div className="grid grid-cols-12 border-b border-black pk">
                    <div className={`${th} col-span-12 bg-slate-200`}>é§…è·é›¢ã®ä¾¡å€¤è¦³ãƒ»å®Ÿå®¶ã¨ã®é–¢ä¿‚</div>
                    <div className={`${th} col-span-2`}>é§…è·é›¢ã‚’æ°—ã«ã™ã‚‹ï¼Ÿ</div><div className={`${td} col-span-4`}>{data.landDetail.station.importance}</div>
                    <div className={`${th} col-span-2`}>ä»Šã¯ä½•åˆ†ï¼Ÿ</div><div className={`${td} col-span-4`}>{wu(data.landDetail.station.current,'åˆ†')}</div>
                    <div className={`${th} col-span-2 h-10`}>æ™‚é–“ã®æ ¹æ‹ ã¯ï¼Ÿ</div><div className={`${td} col-span-10 h-10`}>{data.landDetail.station.logic}</div>
                    <div className={`${th} col-span-2`}>å®Ÿå®¶ã®å ´æ‰€</div><div className={`${td} col-span-4`}>{data.landDetail.parents.loc}</div>
                    <div className={`${th} col-span-2`}>å®Ÿå®¶è·é›¢ã‚’æ°—ã«ã™ã‚‹ï¼Ÿ</div><div className={`${td} col-span-4`}>{data.landDetail.parents.importance}</div>
                    <div className={`${th} col-span-2`}>å®Ÿå®¶ã¸ã®è¡Œãæ–¹å¸Œæœ›</div><div className={`${td} col-span-10`}>{data.landDetail.parents.access}</div>
                  </div>
                  <div className="grid grid-cols-12 pk">
                    <div className="col-span-6 border-r border-black">
                      <div className={`${th} bg-slate-200`}>åœŸåœ°ã¸ã®å„ªå…ˆé †ä½</div>
                      <table className="w-full border-collapse">
                        <thead><tr><th className={th}>é …ç›®</th><th className={th}>ãƒ¡ãƒ¢</th></tr></thead>
                        <tbody>{data.landDetail.priorities.map((p,i) => (<tr key={p.id} className="border-t border-slate-200"><td className={`${th} text-left pl-2 font-medium`}>{i+1}. {p.label}</td><td className={td}>{p.note}</td></tr>))}</tbody>
                      </table>
                    </div>
                    <div className="col-span-6">
                      <div className={`${th} bg-red-100 text-red-800`}>åœŸåœ°ã®NGæ¡ä»¶</div>
                      <table className="w-full border-collapse">
                        <thead><tr><th className={th}>é …ç›®</th><th className={th}>è©³ç´°ãƒ¡ãƒ¢</th></tr></thead>
                        <tbody>{data.landDetail.ng.map((n) => (<tr key={n.id} className="border-t border-slate-200"><td className={`${th} text-left pl-2 font-medium text-red-700`}>{n.label}</td><td className={td}>{n.note}</td></tr>))}</tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* ======== åŸºæœ¬æƒ…å ± ======== */}
            {activeTab === 'basic' && (
              <div className="space-y-6">
                <Section title="ğŸ§‘â€ğŸ¤â€ğŸ§‘ ä»£è¡¨è€…æ§˜ãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ§˜" icon={IcUser}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <InputField label="ä»£è¡¨è€… æ°åï¼ˆãƒ•ãƒªã‚¬ãƒŠï¼‰" value={data.basic.rep.name} onChange={(v) => updateNested('basic','rep','name',v)} />
                    <UnitInput label="ä»£è¡¨è€… å¹´é½¢" units={['æ­³']} value={data.basic.rep.age} onChange={(v) => updateNested('basic','rep','age',v)} />
                    <InputField label="é€£çµ¡å…ˆ" value={data.basic.rep.contact} onChange={(v) => updateNested('basic','rep','contact',v)} />
                    <InputField label="ä½æ‰€ãƒ»éƒµä¾¿ç•ªå·" value={data.basic.rep.address} onChange={(v) => updateNested('basic','rep','address',v)} />
                    <UnitInput label="ä»£è¡¨è€… å¹´å" units={['ä¸‡å††']} value={data.basic.rep.income} onChange={(v) => updateNested('basic','rep','income',v)} />
                    <UnitInput label="å‹¤ç¶šå¹´æ•°" units={['å¹´']} value={data.basic.rep.years} onChange={(v) => updateNested('basic','rep','years',v)} />
                    <div className="col-span-2 border-t my-2" />
                    <InputField label="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ æ°åï¼ˆãƒ•ãƒªã‚¬ãƒŠï¼‰" value={data.basic.partner.name} onChange={(v) => updateNested('basic','partner','name',v)} />
                    <UnitInput label="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ å¹´é½¢" units={['æ­³']} value={data.basic.partner.age} onChange={(v) => updateNested('basic','partner','age',v)} />
                    <UnitInput label="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ å¹´å" units={['ä¸‡å††']} value={data.basic.partner.income} onChange={(v) => updateNested('basic','partner','income',v)} />
                    <UnitInput label="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ å‹¤ç¶šå¹´æ•°" units={['å¹´']} value={data.basic.partner.years} onChange={(v) => updateNested('basic','partner','years',v)} />
                  </div>
                </Section>
                <Section title="å®¶æ—æ§‹æˆï¼ˆçˆ¶æ¯ãƒ»ç¾©çˆ¶æ¯ãªã©ï¼‰" icon={IcUser}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {data.basic.familyMembers.map((m, i) => (
                      <div key={i} className="p-4 bg-slate-50 rounded-lg border border-slate-200">
                        <h4 className="font-bold mb-2 text-indigo-600">{m.role}</h4>
                        <div className="grid grid-cols-2 gap-2">
                          <UnitInput label="å¹´é½¢" units={['æ­³']} value={m.age} onChange={(v) => updateArrayItem('basic','familyMembers',i,'age',v)} />
                          <InputField label="è·æ¥­" value={m.job} onChange={(v) => updateArrayItem('basic','familyMembers',i,'job',v)} />
                          <UnitInput label="å¹´å" units={['ä¸‡å††']} value={m.income} onChange={(v) => updateArrayItem('basic','familyMembers',i,'income',v)} />
                          <InputField label="åŒå±…ï¼ˆç¾ï¼‰" value={m.coLiveNow} onChange={(v) => updateArrayItem('basic','familyMembers',i,'coLiveNow',v)} />
                          <InputField label="åŒå±…ï¼ˆå°†æ¥ï¼‰" value={m.coLiveFuture} onChange={(v) => updateArrayItem('basic','familyMembers',i,'coLiveFuture',v)} />
                        </div>
                      </div>
                    ))}
                  </div>
                </Section>
              </div>
            )}

            {/* ======== ç·åˆãƒ’ã‚¢ãƒªãƒ³ã‚° ======== */}
            {activeTab === 'general' && (
              <div className="space-y-6">
                <Section title="ğŸ§‘â€ğŸ¤â€ğŸ§‘ ç”Ÿæ´»æƒ…å ±" icon={IcHome}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <InputField label="æœ€å¯„ã‚Šé§…" value={data.general.life.station} onChange={(v) => updateNested('general','life','station',v)} />
                    <UnitInput label="æœ€å¯„ã‚Šé§…ã¾ã§ã®æ™‚é–“" units={['åˆ†', 'æ™‚é–“']} value={data.general.life.stationTime} onChange={(v) => updateNested('general','life','stationTime',v)} />
                    <InputField label="ç¾åœ¨ã®ä½å±…å½¢æ…‹" value={data.general.life.housingType} onChange={(v) => updateNested('general','life','housingType',v)} />
                    <InputField label="å®¶æ—æ§‹æˆï¼ˆå°†æ¥æƒ³å®šå«ã‚€ï¼‰" value={data.general.life.family} onChange={(v) => updateNested('general','life','family',v)} />
                    <UnitInput label="å®¶è³ƒ" units={['ä¸‡å††/æœˆ']} value={data.general.life.rent} onChange={(v) => updateNested('general','life','rent',v)} />
                    <UnitInput label="é§è»Šå ´ä»£" units={['ä¸‡å††/æœˆ']} value={data.general.life.parking} onChange={(v) => updateNested('general','life','parking',v)} />
                    <UnitInput label="ãã®ä»–å›ºå®šè²»" units={['ä¸‡å††/æœˆ']} value={data.general.life.otherCost} onChange={(v) => updateNested('general','life','otherCost',v)} />
                    <InputField label="å®Ÿå®¶å ´æ‰€" value={data.general.life.homeLoc} onChange={(v) => updateNested('general','life','homeLoc',v)} />
                    <InputField label="è¶£å‘³" value={data.general.life.hobby} onChange={(v) => updateNested('general','life','hobby',v)} />
                    <div />
                    <TextAreaField label="å®¶ã¥ãã‚Šã‚’è€ƒãˆå§‹ã‚ãŸç†ç”±" value={data.general.life.reason} onChange={(v) => updateNested('general','life','reason',v)} />
                    <TextAreaField label="Gãƒã‚¦ã‚¹ã‚’çŸ¥ã£ãŸãã£ã‹ã‘ãƒ»æ¥å ´å‹•æ©Ÿ" value={data.general.life.trigger} onChange={(v) => updateNested('general','life','trigger',v)} />
                    <TextAreaField label="Gãƒã‚¦ã‚¹ã§é–¢å¿ƒã®ã‚ã‚‹ã“ã¨" value={data.general.life.interest} onChange={(v) => updateNested('general','life','interest',v)} />
                    <TextAreaField label="ç¾åœ¨ã®æ¤œè¨ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»å°è±¡" value={data.general.life.currentMaker} onChange={(v) => updateNested('general','life','currentMaker',v)} />
                  </div>
                </Section>
                <Section title="ğŸ ã€ç‰©ã€‘åœŸåœ°ãƒ»å»ºç‰©" icon={IcMap}>
                  <h3 className="font-bold text-slate-700 mb-3 border-l-4 border-blue-500 pl-2">â‰ªåœŸåœ°â‰«</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6 mb-6">
                    <InputField label="åœŸåœ°æ¢ã—ã®æœ‰ç„¡" value={data.general.land.hasLand} onChange={(v) => updateNested('general','land','hasLand',v)} />
                    <InputField label="å¸Œæœ›ã‚¨ãƒªã‚¢ã¨ç†ç”±" value={data.general.land.areaReason} onChange={(v) => updateNested('general','land','areaReason',v)} />
                    <InputField label="é€šå‹¤å…ˆãƒ»æ–¹æ³•ãƒ»å¸Œæœ›è·é›¢æ„Ÿ" value={data.general.land.commuteGoal} onChange={(v) => updateNested('general','land','commuteGoal',v)} />
                    <InputField label="å®Ÿå®¶ã¨ã®è·é›¢ãƒ»é–¢ä¿‚æ€§" value={data.general.land.parentsRel} onChange={(v) => updateNested('general','land','parentsRel',v)} />
                    <InputField label="é§…ã¾ã§ã®è·é›¢ã‚„ç§»å‹•æ‰‹æ®µã¸ã®è€ƒãˆ" value={data.general.land.stationThought} onChange={(v) => updateNested('general','land','stationThought',v)} />
                    <InputField label="ä»Šã®ä½ã¾ã„ã‚’é¸ã‚“ã ç†ç”±" value={data.general.land.currentHomeReason} onChange={(v) => updateNested('general','land','currentHomeReason',v)} />
                    <UnitInput label="åœŸåœ°äºˆç®—" units={['ä¸‡å††']} value={data.general.land.landBudget} onChange={(v) => updateNested('general','land','landBudget',v)} />
                  </div>
                  <h3 className="font-bold text-slate-700 mb-3 border-l-4 border-indigo-500 pl-2">â‰ªå»ºç‰©â‰«</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <InputField label="éšæ•°" value={data.general.building.floors} onChange={(v) => updateNested('general','building','floors',v)} />
                    <InputField label="éƒ¨å±‹æ•°ã¨ç”¨é€”" value={data.general.building.rooms} onChange={(v) => updateNested('general','building','rooms',v)} />
                    <TextAreaField label="å¸Œæœ›ã™ã‚‹è¿½åŠ éƒ¨å±‹ï¼ˆå’Œå®¤ãƒ»WICãƒ»æ›¸æ–ãªã©ï¼‰ã¨ç†ç”±" value={data.general.building.extraRooms} onChange={(v) => updateNested('general','building','extraRooms',v)} />
                    <TextAreaField label="é–“å–ã‚Šã®ã“ã ã‚ã‚Šãƒ»å›°ã£ã¦ã„ã‚‹ç‚¹" value={data.general.building.layoutPoint} onChange={(v) => updateNested('general','building','layoutPoint',v)} />
                    <TextAreaField label="ã‚„ã‚ŠãŸã„ã“ã¨ãƒ»ç†ç”±" value={data.general.building.goals} onChange={(v) => updateNested('general','building','goals',v)} />
                    <InputField label="è»Šå°æ•°ã¨ç†ç”±" value={data.general.building.cars} onChange={(v) => updateNested('general','building','cars',v)} />
                    <InputField label="åº­ã®å¸Œæœ›" value={data.general.building.garden} onChange={(v) => updateNested('general','building','garden',v)} />
                    <UnitInput label="å»ºç‰©äºˆç®—" units={['ä¸‡å††']} value={data.general.building.buildingBudget} onChange={(v) => updateNested('general','building','buildingBudget',v)} />
                  </div>
                </Section>
                <Section title="ğŸ’´ã€é‡‘ã€‘è³‡é‡‘è¨ˆç”»" icon={IcCoins}>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-x-4">
                    <UnitInput label="ã”ä¸»äººå¹´å" units={['ä¸‡å††']} value={data.general.money.husbandIncome} onChange={(v) => updateNested('general','money','husbandIncome',v)} />
                    <UnitInput label="å¥¥æ§˜å¹´å" units={['ä¸‡å††']} value={data.general.money.wifeIncome} onChange={(v) => updateNested('general','money','wifeIncome',v)} />
                    <UnitInput label="ç·äºˆç®—" units={['ä¸‡å††']} value={data.general.money.totalBudget} onChange={(v) => updateNested('general','money','totalBudget',v)} />
                    <UnitInput label="é ­é‡‘äºˆå®šé¡" units={['ä¸‡å††']} value={data.general.money.downPayment} onChange={(v) => updateNested('general','money','downPayment',v)} />
                    <UnitInput label="è²¯é‡‘é¡" units={['ä¸‡å††']} value={data.general.money.savings} onChange={(v) => updateNested('general','money','savings',v)} />
                    <UnitInput label="æ´åŠ©é‡‘" units={['ä¸‡å††']} value={data.general.money.aid} onChange={(v) => updateNested('general','money','aid',v)} />
                    <UnitInput label="æœˆã€…å¸Œæœ›é¡" units={['ä¸‡å††/æœˆ']} value={data.general.money.monthlyHope} onChange={(v) => updateNested('general','money','monthlyHope',v)} />
                  </div>
                  <TextAreaField label="æ—¢å­˜å€Ÿå…¥ï¼ˆæ®‹é¡ãƒ»æœˆã€…ãƒ»ãƒœãƒ¼ãƒŠã‚¹ãƒ»å¹´é–“ï¼‰" value={data.general.money.existingLoan} onChange={(v) => updateNested('general','money','existingLoan',v)} />
                  <TextAreaField label="ç†æƒ³ã®æœˆã€…æ”¯æ‰•ã„é¡ã¨ãã®ç†ç”±" value={data.general.money.idealPayment} onChange={(v) => updateNested('general','money','idealPayment',v)} />
                  <TextAreaField label="ç¾åœ¨ã®å®¶è³ƒã¨ã®å·®ã¸ã®è€ƒãˆ" value={data.general.money.rentGap} onChange={(v) => updateNested('general','money','rentGap',v)} />
                </Section>
                <Section title="â°ã€æ™‚ã€‘å¸Œæœ›æ™‚æœŸ / âš”ã€æ•µã€‘ç«¶åˆ" icon={IcClock}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <TextAreaField label="å¸Œæœ›å…¥å±…æ™‚æœŸã¨ç†ç”±" value={data.general.time.period} onChange={(v) => updateNested('general','time','period',v)} />
                    <InputField label="å…¥å±…ãƒªãƒŸãƒƒãƒˆã®æœ‰ç„¡" value={data.general.time.limit} onChange={(v) => updateNested('general','time','limit',v)} />
                    <div className="col-span-2 border-t my-2" />
                    <InputField label="æ¤œè¨ä»–ç¤¾å" value={data.general.rival.name} onChange={(v) => updateNested('general','rival','name',v)} />
                    <div />
                    <TextAreaField label="æ°—ã«å…¥ã£ã¦ã„ã‚‹ç‚¹" value={data.general.rival.pros} onChange={(v) => updateNested('general','rival','pros',v)} />
                    <TextAreaField label="ä¸æº€ç‚¹" value={data.general.rival.cons} onChange={(v) => updateNested('general','rival','cons',v)} />
                  </div>
                </Section>
                <Section title="ğŸ§ªã€ãƒ†ã‚¹ã‚¯ãƒ­ã€‘" icon={IcFlask}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <InputField label="æœ‰ç„¡" value={data.general.testClose.hasTest} onChange={(v) => updateNested('general','testClose','hasTest',v)} />
                    <div />
                    <TextAreaField label="ãƒ†ã‚¹ã‚¯ãƒ­çµæœ" value={data.general.testClose.result} onChange={(v) => updateNested('general','testClose','result',v)} />
                    <TextAreaField label="Gãƒã‚¦ã‚¹ã¸ã®ä¸æº€ç‚¹ãƒ»ä¸å®‰ç‚¹" value={data.general.testClose.complaints} onChange={(v) => updateNested('general','testClose','complaints',v)} />
                    <TextAreaField label="æ¬¡å›ã‚¢ãƒã‚¤ãƒ³ãƒˆæ—¥æ™‚ãƒ»å†…å®¹" value={data.general.testClose.nextDetail} onChange={(v) => updateNested('general','testClose','nextDetail',v)} />
                  </div>
                </Section>
              </div>
            )}

            {/* ======== åœŸåœ°ã‚¨ãƒªã‚¢ç²¾æŸ» ======== */}
            {activeTab === 'land' && (
              <div className="space-y-6">
                <Section title="ã€åœŸåœ°ã‚¨ãƒªã‚¢ ç²¾æŸ»ãƒ’ã‚¢ãƒªãƒ³ã‚°ã€‘" icon={IcMap}>
                  <InputField label="å¸Œæœ›ã‚¨ãƒªã‚¢" value={data.landDetail.area.target} onChange={(v) => updateNested('landDetail','area','target',v)} />
                  <TextAreaField label="ãªãœï¼Ÿæ·±ãèã" value={data.landDetail.area.whyDeep} onChange={(v) => updateNested('landDetail','area','whyDeep',v)} />
                </Section>
                <Section title="é€šå‹¤äº‹æƒ… â€»å¤«å©¦ãã‚Œãã‚Œèã" icon={IcTrain}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div className="space-y-3">
                      <h4 className="font-bold text-blue-600 border-b pb-1">ã”ä¸»äººæ§˜</h4>
                      <InputField label="é€šå‹¤å…ˆ" value={data.landDetail.husband.dest} onChange={(v) => updateNested('landDetail','husband','dest',v)} />
                      <UnitInput label="æ‰€è¦æ™‚é–“" units={['åˆ†', 'æ™‚é–“']} value={data.landDetail.husband.time} onChange={(v) => updateNested('landDetail','husband','time',v)} />
                      <InputField label="æ–¹æ³•ï¼ˆé›»è»Šãƒ»è»Šãªã©ï¼‰" value={data.landDetail.husband.method} onChange={(v) => updateNested('landDetail','husband','method',v)} />
                      <InputField label="é€šå‹¤ã¸ã®å°è±¡" value={data.landDetail.husband.feeling} onChange={(v) => updateNested('landDetail','husband','feeling',v)} />
                      <UnitInput label="æ¬¡ã¯ã©ã‚Œãã‚‰ã„ãªã‚‰ã„ã‘ã‚‹ï¼Ÿ" units={['åˆ†', 'æ™‚é–“']} value={data.landDetail.husband.limit} onChange={(v) => updateNested('landDetail','husband','limit',v)} />
                    </div>
                    <div className="space-y-3">
                      <h4 className="font-bold text-pink-600 border-b pb-1">å¥¥æ§˜</h4>
                      <InputField label="é€šå‹¤å…ˆ" value={data.landDetail.wife.dest} onChange={(v) => updateNested('landDetail','wife','dest',v)} />
                      <UnitInput label="æ‰€è¦æ™‚é–“" units={['åˆ†', 'æ™‚é–“']} value={data.landDetail.wife.time} onChange={(v) => updateNested('landDetail','wife','time',v)} />
                      <InputField label="æ–¹æ³•ï¼ˆé›»è»Šãƒ»è»Šãªã©ï¼‰" value={data.landDetail.wife.method} onChange={(v) => updateNested('landDetail','wife','method',v)} />
                      <InputField label="é€šå‹¤ã¸ã®å°è±¡" value={data.landDetail.wife.feeling} onChange={(v) => updateNested('landDetail','wife','feeling',v)} />
                      <UnitInput label="æ¬¡ã¯ã©ã‚Œãã‚‰ã„ãªã‚‰ã„ã‘ã‚‹ï¼Ÿ" units={['åˆ†', 'æ™‚é–“']} value={data.landDetail.wife.limit} onChange={(v) => updateNested('landDetail','wife','limit',v)} />
                    </div>
                  </div>
                </Section>
                <Section title="é§…è·é›¢ãƒ»å®Ÿå®¶ãƒ»å„ªå…ˆé †ä½" icon={IcHeart}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6 mb-6">
                    <div className="space-y-3">
                      <h4 className="font-bold text-slate-700">é§…è·é›¢ã®ä¾¡å€¤è¦³</h4>
                      <InputField label="é§…ã¾ã§ã®è·é›¢æ°—ã«ã™ã‚‹ï¼Ÿ" value={data.landDetail.station.importance} onChange={(v) => updateNested('landDetail','station','importance',v)} />
                      <InputField label="ãã®æ™‚é–“ã®æ ¹æ‹ ã¯ï¼Ÿ" value={data.landDetail.station.logic} onChange={(v) => updateNested('landDetail','station','logic',v)} />
                      <UnitInput label="ä»Šã¯ä½•åˆ†ï¼Ÿ" units={['åˆ†', 'æ™‚é–“']} value={data.landDetail.station.current} onChange={(v) => updateNested('landDetail','station','current',v)} />
                    </div>
                    <div className="space-y-3">
                      <h4 className="font-bold text-slate-700">å®Ÿå®¶ã¨ã®é–¢ä¿‚</h4>
                      <InputField label="å®Ÿå®¶ã¯ï¼Ÿ" value={data.landDetail.parents.loc} onChange={(v) => updateNested('landDetail','parents','loc',v)} />
                      <InputField label="å®Ÿå®¶ã¾ã§ã®è·é›¢æ°—ã«ã™ã‚‹ï¼Ÿ" value={data.landDetail.parents.importance} onChange={(v) => updateNested('landDetail','parents','importance',v)} />
                      <InputField label="ã©ã†ã‚„ã£ã¦è¡Œã‘ãŸã‚‰ã„ã„ï¼Ÿ" value={data.landDetail.parents.access} onChange={(v) => updateNested('landDetail','parents','access',v)} />
                    </div>
                  </div>
                  <h4 className="font-bold text-slate-700 mb-2">åœŸåœ°ã«å¯¾ã—ã¦æ±‚ã‚ã‚‹ã“ã¨ï¼ˆå„ªå…ˆé †ä½ï¼‰</h4>
                  <table className="w-full text-xs border border-slate-200 rounded-lg overflow-hidden mb-6">
                    <thead className="bg-slate-50 border-b"><tr><th className="p-2 text-left">é …ç›®</th><th className="p-2 text-left">ãƒ¡ãƒ¢</th></tr></thead>
                    <tbody className="divide-y">
                      {data.landDetail.priorities.map(p => (
                        <tr key={p.id}><td className="p-2 font-medium w-48">{p.label}</td><td className="p-1"><input className="w-full p-1 outline-none bg-transparent" value={p.note} onChange={e => updateList('landDetail','priorities',p.id,e.target.value)} /></td></tr>
                      ))}
                    </tbody>
                  </table>
                  <h4 className="font-bold text-red-700 mb-2">åœŸåœ°ã«å¯¾ã™ã‚‹NG</h4>
                  <div className="grid grid-cols-1 gap-2">
                    {data.landDetail.ng.map(n => (
                      <div key={n.id} className="flex items-center gap-4 bg-red-50 p-2 rounded border border-red-100">
                        <span className="w-56 font-bold text-red-900 text-xs">{n.label}</span>
                        <input className="flex-1 text-xs p-1 border rounded" placeholder="è©³ç´°ãƒ¡ãƒ¢" value={n.note} onChange={e => updateList('landDetail','ng',n.id,e.target.value)} />
                      </div>
                    ))}
                  </div>
                </Section>
              </div>
            )}

            <footer className="mt-8 text-center text-slate-400 text-[10px] pb-6 no-print">
              <p>Â© G-House Internal Sales System | Version Final</p>
            </footer>
          </div>
        </div>
      );
    };

    // ======== ãƒ«ãƒ¼ãƒˆã‚¢ãƒ—ãƒª ========
    const App = () => {
      const [session, setSession]       = useState(null);
      const [authLoading, setAuthLoading] = useState(true);
      const [screen, setScreen]         = useState('list');
      const [customers, setCustomers]   = useState([]);
      const [branches, setBranches]     = useState([]);
      const [currentId, setCurrentId]   = useState(null);
      const [showNewModal, setShowNewModal] = useState(false);
      const [dbLoading, setDbLoading]   = useState(false);

      // èªè¨¼çŠ¶æ…‹ã‚’ç›£è¦–
      useEffect(() => {
        sb.auth.getSession().then(({ data: { session } }) => {
          setSession(session);
          setAuthLoading(false);
        });
        const { data: { subscription } } = sb.auth.onAuthStateChange((_e, session) => {
          setSession(session);
          if (!session) { setCustomers([]); setScreen('list'); }
        });
        return () => subscription.unsubscribe();
      }, []);

      // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ã‚«ãƒ«ãƒ†ä¸€è¦§ã¨æ‹ ç‚¹ä¸€è¦§ã‚’å–å¾—
      useEffect(() => {
        if (!session) return;
        loadCustomers();
        loadBranches();
      }, [session]);

      const fromDB = (row) => ({
        id:           row.id,
        staffName:    row.staff_name,
        belong:       row.belong,
        customerName: row.customer_name,
        createdAt:    row.created_at,
        updatedAt:    row.updated_at,
        karteData:    row.karte_data || emptyKarteData(),
      });

      const loadCustomers = async () => {
        setDbLoading(true);
        const { data } = await sb.from('customers').select('*').order('updated_at', { ascending: false });
        if (data) setCustomers(data.map(fromDB));
        setDbLoading(false);
      };

      const loadBranches = async () => {
        const { data } = await sb.from('branches').select('*').order('created_at', { ascending: true });
        if (data) setBranches(data);
      };

      const handleAddBranch = async (name) => {
        const { data, error } = await sb.from('branches').insert({ name }).select().single();
        if (!error && data) setBranches(prev => [...prev, data]);
      };

      const handleDeleteBranch = async (id) => {
        const { error } = await sb.from('branches').delete().eq('id', id);
        if (!error) setBranches(prev => prev.filter(b => b.id !== id));
      };

      const handleCreate = async ({ staffName, belong, customerName }) => {
        const { data, error } = await sb.from('customers').insert({
          staff_id:      session.user.id,
          staff_name:    staffName,
          belong,
          customer_name: customerName,
          karte_data:    emptyKarteData(),
        }).select().single();
        if (error) {
          console.error('Supabase insert error:', error);
          return error.message; // ã‚¨ãƒ©ãƒ¼æ–‡å­—åˆ—ã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã¸è¿”ã™
        }
        if (data) {
          setCustomers(prev => [fromDB(data), ...prev]);
          setCurrentId(data.id);
          setShowNewModal(false);
          setScreen('edit');
        }
        return null;
      };

      const handleEdit = (id) => { setCurrentId(id); setScreen('edit'); };

      const handleSave = async (id, karteData) => {
        const { error } = await sb.from('customers').update({
          karte_data:  karteData,
          updated_at:  new Date().toISOString(),
        }).eq('id', id);
        if (!error) {
          setCustomers(prev => prev.map(c => c.id === id
            ? { ...c, karteData, updatedAt: new Date().toISOString() } : c));
        }
      };

      const handleDelete = async (id) => {
        const { error } = await sb.from('customers').delete().eq('id', id);
        if (!error) setCustomers(prev => prev.filter(c => c.id !== id));
      };

      const handleUpdateInfo = async (id, { staffName, belong, customerName }) => {
        const { error } = await sb.from('customers').update({
          staff_name:    staffName,
          belong,
          customer_name: customerName,
          updated_at:    new Date().toISOString(),
        }).eq('id', id);
        if (!error) {
          setCustomers(prev => prev.map(c => c.id === id
            ? { ...c, staffName, belong, customerName, updatedAt: new Date().toISOString() } : c));
        }
        return error ? error.message : null;
      };

      const handleBack = () => { setScreen('list'); setCurrentId(null); };

      const handleLogout = async () => {
        await sb.auth.signOut();
        setCustomers([]);
        setScreen('list');
        setCurrentId(null);
      };

      if (authLoading) return (
        <div className="min-h-screen bg-slate-100 flex items-center justify-center">
          <p className="text-slate-500 font-bold text-sm">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      );

      if (!session) return <LoginScreen />;

      const currentCustomer = customers.find(c => c.id === currentId);

      return (
        <>
          {showNewModal && <NewCustomerModal onClose={() => setShowNewModal(false)} onCreate={handleCreate} />}
          {screen === 'list' && (
            <CustomerList
              customers={customers}
              onNew={() => setShowNewModal(true)}
              onEdit={handleEdit}
              onDelete={handleDelete}
              onLogout={handleLogout}
              userEmail={session.user.email}
              dbLoading={dbLoading}
              branches={branches}
              onAddBranch={handleAddBranch}
              onDeleteBranch={handleDeleteBranch}
            />
          )}
          {screen === 'edit' && currentCustomer && (
            <KarteEditor
              customer={currentCustomer}
              onBack={handleBack}
              onSave={handleSave}
              onUpdateInfo={handleUpdateInfo}
            />
          )}
        </>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
